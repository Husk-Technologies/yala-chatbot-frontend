services:
  - type: web
    name: whatsapp-bot
    env: docker
    plan: starter
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      # App settings
      - key: REDIS_URL
        fromService:
          type: redis
          name: whatsapp-bot-redis
          property: connectionString
      - key: REDIS_REQUIRED
        value: "1"
      - key: REDIS_KEY_PREFIX
        value: "wa_bot"
      - key: SESSION_TTL_SECONDS
        value: "1500"

      # Webhook worker tuning (safe defaults)
      - key: WEBHOOK_WORKER_THREADS
        value: "16"
      - key: WEBHOOK_MAX_INFLIGHT
        value: "128"

      # Meta WhatsApp Cloud API (set in Render dashboard)
      - key: META_WA_ACCESS_TOKEN
        sync: false
      - key: META_WA_PHONE_NUMBER_ID
        sync: false
      - key: META_WEBHOOK_VERIFY_TOKEN
        sync: false
      - key: META_APP_SECRET
        sync: false
      - key: VERIFY_META_SIGNATURES
        value: "1"

      # Backend integration + public URL (set in Render dashboard)
      - key: BACKEND_BASE_URL
        sync: false
      - key: BACKEND_AUTH_BEARER_TOKEN
        sync: false
      - key: PUBLIC_BASE_URL
        sync: false

      # Disable debug endpoints by default
      - key: DEBUG_ENDPOINTS
        value: "0"

  - type: redis
    name: whatsapp-bot-redis
    plan: starter
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru
